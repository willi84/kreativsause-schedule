{% set data = params.data %}

{% set filter_groups = { tag: [], category: [], day: [], year: [] } %}

<div class="container my-5">
  <h1 class="mb-3">Workshops 2025</h1>
  <p class="text-muted">Alle geplanten Workshops im Überblick</p>

  {{ component("search", {
    placeholder: "Workshop suchen...",
    uid: "talks",
    category: "talks",
    no_result: ["Kein Workshop gefunden", "Versuch es mit einem anderen Begriff."]
  }) }}
<div data-search="talks">
  {% for id, item in data %}
    {% if item.year == "2025" %}
      {# Tag-Filter sammeln #}
      {% if item.tags %}
        {% for tag in item.tags %}
          {% if tag not in filter_groups.tag %}
            {% set filter_groups = filter_groups | merge({ tag: filter_groups.tag.concat([tag]) }) %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% if item.category %}
        {% for cat in item.category %}
          {% if cat not in filter_groups.category %}
            {% set filter_groups = filter_groups | merge({ category: filter_groups.category.concat([cat]) }) %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {# {% if item.days %}
        {% for day in item.days %}
          {% if day not in filter_groups.day %}
            {% set filter_groups = filter_groups | merge({ day: filter_groups.day.concat([day]) }) %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% if item.year and item.year not in filter_groups.year %}
        {% set filter_groups = filter_groups | merge({ year: filter_groups.year.concat([item.year]) }) %}
      {% endif %} #}

      <div class="card my-4 talk-card searchable" data-category="workshops" data-talk="{{ id }}" 
           data-tags="{{ item.tags | join(',') }}"
           data-day="{{ item.days | join(',') }}"
           data-year="{{ item.year }}"
           data-title="{{ item.title | escape }}">
        <div class="card-body">
          <h5 classs="card-title">
            {% if item.title %}
              <span class="talk-value">{{ item.title }}</span>
              <span class="talk-search hidden">{{ item.title }}</span>
            {% endif %}
          </h5>
        <div class="mb-2">

          {# <small class="text-muted">
            {% if item.days %}
              {% for day in item.days %}
                <span class="talk-value">{{ day }}</span>
              {% endfor %}
            {% endif %}
             {% if item.year %}
                <span class="talk-value">{{ item.year }}</span>
              {% endif %}
          </small> #}
          <small class="text-muted">
           {% if item.startDate and item.startDate == item.endDate %}
            <span class="talk-value">📅{{ item.days }}, {{ item.startDate }}</span>
            <span class="talk-search hidden">{{ item.startDate }}</span>
            {% if item.startTime %}
              <span class="talk-value">🕒{{ item.startTime }}</span>
              <span class="talk-search hidden">{{ item.startTime }}</span>
            {% endif %}
            {% if item.endTime %}
              <span class="talk-value"> - {{ item.endTime }}</span>
              <span class="talk-search hidden">{{ item.endTime }}</span>
            {% endif %}
          {% else %}
          <span class="talk-value">{{ item.day }}</span>
            <span class="talk-value">📅{{ item.days[0] }}, {{ item.startDate }} - {{ item.days[item.days.length -1] }}, {{ item.endDate }}</span>
            <span class="talk-search hidden">{{ item.startDate }} - {{ item.endDate }}</span>
            {% if item.startTime %}
              <span class="talk-value">🕒{{ item.startTime }}</span>
              <span class="talk-search hidden">{{ item.startTime }}</span>
            {% endif %}
            {% if item.endTime %}
              <span class="talk-value"> - {{ item.endTime }}</span>
              <span class="talk-search hidden">{{ item.endTime }}</span>
            {% endif %} 
          {% endif %} 
        </small>
          
        
        </div>
        {% if item.venue %}
          <div class="mb-2">
            {# {% for venue_line in item.venue %} #}
              <span class="talk-value">📍 {{ item.venue[0] }}</span>
              <span class="talk-search hidden">{{ item.venue[0] }}</span>
            {# {% endfor %} #}
          </div>
      {% endif %}
      <div class="mb-2">
        {% if item.tags %}
          {% for tag in item.tags %}
            <span class="badge text-light" style="background-color: #0F766E">
              {{ tag }}
            </span>
          {% endfor %}
        {% endif %}
            {# {% if item.category %}
            {% for cat in item.category %}
            <span class="badge text-light" style="background-color: #0F766E">
                {{ cat }}
              </span>
          {% endfor %}
        {% endif %} #}
      </div>
      {% if item.description %}
      {% for desc in item.description %}
      <p class="card-text text-muted">
            <span class="talk-value">{{ desc | safe }}</span>
            <span class="talk-search hidden">{{ desc }}</span>
          </p>
          {% endfor %}
      {% endif %}
      {% if item.register %}
          <p class="card-text text-muted">
            <a class="btn btn-sm btn-primary mt-2" href="{{ item.register }}" target="_blank">Zur Anmeldung</a>
            {% if item.kosten%}
              <span class="talk-value">💰{{ item.kosten }}</span>
              <span class="talk-searcg hidden">💰{{ item.kosten }}</span>
            {% endif %}
          </p>
          {% endif %}
      
        </div>
        {% if item.images and item.images.length > 1 %}
          <img src="{{ item.images[1] }}" class="card-img-bottom teaser-image" alt="{{ item.title }}">
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
</div>
  
</div>