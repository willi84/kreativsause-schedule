{% set data = params.data %}

{% set filter_groups = { tag: [], category: [], day: [], year: [] } %}


<div class="container my-5">
  <h1 class="mb-3">Workshops 2025</h1>
  <pre><code>https://kreativsause-schedule.vercel.app/api/calendar</code></pre>
  {# <a href="/api/calendar" download="kreativsause.ics">📥 Kalender herunterladen</a>

<p>Oder Kalender abonnieren:</p>
<ul>
  <li><a href="webcal://kreativsause-schedule.vercel.app/api/calendar">🗓 In Kalender-App abonnieren</a></li>
  <li><a href="https://calendar.google.com/calendar/u/0/r?cid=https://kreativsause-schedule.vercel.app/api/calendar" target="_blank">📆 In Google Kalender hinzufügen</a></li>
</ul> #}

  <div class="view-toggle mb-4">
    <button class="btn btn-sm btn-outline-primary me-2" data-view="standard-view">📋 Standardansicht</button>
    <button class="btn btn-sm btn-outline-secondary" data-view="compact-view">📑 Kompaktansicht</button>
  </div>
  <p class="text-mXuted">Kleines tool um durch die Workshops zu stöbern</p>


  {{ component("search", {
    placeholder: "Workshop suchen...",
    uid: "talks",
    category: "talks",
    no_result: ["Kein Workshop gefunden", "Versuch es mit einem anderen Begriff."]
  }) }}
<div data-search="talks">
  {# filter #}
  <div class="filter-container">
    <div class="filter-group">
      <h5>Filter</h5>
      <div class="filter-type-container"></div>
      <div class="filter-room-container"></div>
    </div>

  <div class="standard-view">
    {% for day in data.days %}
      <h2 class="mt-5  day-table-headline" data-day="{{ day }}">{{ day }}, {{data.data[day][0].startDate}} {{data.data[day][0].year}}</h2>
      <section class="day-table">

          {% for item in data.data[day] %}
            {# Tag-Filter sammeln #}
            {% if item.tags %}
              {% for tag in item.tags %}
                {% if tag not in filter_groups.tag %}
                  {% set filter_groups = filter_groups | merge({ tag: filter_groups.tag.concat([tag]) }) %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {% if item.category %}
              {% for cat in item.category %}
                {% if cat not in filter_groups.category %}
                  {% set filter_groups = filter_groups | merge({ category: filter_groups.category.concat([cat]) }) %}
                {% endif %}
              {% endfor %}
            {% endif %}
            <div class="card my-4 talk-card searchable"  data-room="🏠 {{item.room.orig}}" data-day="{{ day }}" data-category="workshops" data-talk="{{ id }}"  data-start-time="{{ item.startTimeInt }}" data-end-time="{{ item.endTimeInt }}"
                data-tags="{{ item.tags | join(',') }}"
                data-day="{{ item.days | join(',') }}"
                data-year="{{ item.year }}"
                data-title="{{ item.title | escape }}">
              <div class="card-body">
                {# title #}
                <section data-filter="title">
                  {% if item.title %}
                    <h5 classs="card-title">
                      <span class="talk-states">
                        <span data-status-item="live"  class="blinking-emoji">🔴</span>
                        <span data-status-item="done">✅</span>
                        <span data-status-item="upcoming">⚪</span>
                      </span>
                      <span class="talk-value">{{ item.title }}</span>
                      <span class="talk-search hidden">{{ item.title }}</span>
                    </h5>
                  {% endif %}
                </section>
              <div class="mb-2">
      
                <small class="text-muted">
                {% if item.startDate and item.startDate == item.endDate %}
                  <span data-filter="date">
                    <span class="talk-value">📅 {{ item.days }}, {{ item.startDate }}</span>
                    <span class="talk-search hidden">{{ item.startDate }}</span>
                  </span>
                  <span data-filter="time">
                    {% if item.startTime %}
                      <span class="talk-value">🕒{{ item.startTime }}</span>
                      <span class="talk-search hidden">{{ item.startTime }}</span>
                    {% endif %}
                    {% if item.endTime %}
                      <span class="talk-value"> - {{ item.endTime }}</span>
                      <span class="talk-search hidden">{{ item.endTime }}</span>
                    {% endif %}
                  </span>
                {% else %}
                <span data-filter="date">
                  <span class="talk-value">{{ item.day }}</span>
                  <span class="talk-value">📅{{ item.days[0] }}, {{ item.startDate }} - {{ item.days[item.days.length -1] }}, {{ item.endDate }}</span>
                  <span class="talk-search hidden">{{ item.startDate }} - {{ item.endDate }}</span>
                </span>
                <span data-filter="time">
                  {% if item.startTime %}
                    <span class="talk-value">🕒{{ item.startTime }}</span>
                    <span class="talk-search hidden">{{ item.startTime }}</span>
                  {% endif %}
                  {% if item.endTime %}
                    <span class="talk-value"> - {{ item.endTime }}</span>
                    <span class="talk-search hidden">{{ item.endTime }}</span>
                  {% endif %} 
                </span>

                {% endif %} 
              </small>
                
              
              </div>
              <div class="mb-2" data-filter="speakers">
                {% if item.speakers %}
                  {% for speaker in item.speakers %}
                    <span class="talk-value">👤 {{ speaker }}</span>
                    <span class="talk-search hidden">{{ speaker }}</span>
                  {% endfor %}
                {% endif %}
              </div>
              {% if item.venue %}
                <div class="mb-2" data-filter="venue">
                    <span class="talk-value">📍 {{ item.venue[0] }}</span>
                    <span class="talk-search hidden">{{ item.venue[0] }}</span>
                </div>
              {% endif %}
              {% if item.room %}
                <div class="mb-2" data-filter="room">
                    <span class="talk-value">🏠 {{ item.room.name }}</span>
                    <span class="talk-search hidden">{{ item.room.name }}</span>
                </div>
              {% endif %}
            <div class="mb-2" data-filter="tags">
              {% if item.tags %}
                {% for tag in item.tags %}
                  <span class="badge text-light" style="background-color: #0F766E">
                    {{ tag }}
                  </span>
                {% endfor %}
              {% endif %}
            </div>
            {% if item.description %}
              <section data-filter="description">
                {% for desc in item.description %}
                  <p class="card-text text-muted">
                      <span class="talk-value">{{ desc | safe }}</span>
                      <span class="talk-search hidden">{{ desc }}</span>
                    </p>
                {% endfor %}
              </section>
            {% endif %}
            {% if item.register %}
                <p class="card-text text-muted" data-filter="register">
                  <a class="btn btn-sm btn-primary mt-2" href="{{ item.register }}" target="_blank">Zur Anmeldung</a>
                  {% if item.kosten%}
                    <span class="talk-value">💰{{ item.kosten }}</span>
                    <span class="talk-searcg hidden">💰{{ item.kosten }}</span>
                  {% endif %}
                </p>
                {% endif %}
            
              </div>
              {% if item.images and item.images.length > 1 %}
                <img data-filter="image" src="{{ item.images[1] }}" class="card-img-bottom teaser-image" alt="{{ item.title }}">
              {% endif %}
            </div>
        {% endfor %}
        {% endfor %}
      </section>
      

    
  </div>
  <div class="compact-view">
    {% for day in data.days %}
      <h2 class="mt-5  day-table-headline" data-day="{{ day }}">{{ day }}, {{data.data[day][0].startDate}}  {{data.data[day][0].year}}</h2>
      
      <table class="table talkXX-card day-table" data-day="{{ day }}" data-year="2025">
        <tr>
          <th data-filter="state"></th>
          <th data-filter="register">Register</th>
          <th data-filter="date">📅 Datum</th>
          <th data-filter="room">🏠 Raum</th>
          <th data-filter="time">🕒Zeit</th>
          <th data-filter="speakers">👤Speaker</th>
          <th data-filter="title">Workshop</th>
        </tr>
      {% for item in data.data[day] %}
      <tr class="searchable talk-card" data-room="🏠 {{item.room.orig}}" data-category="workshops" data-talk="{{ id }}" data-start-time="{{ item.startTimeInt }}" data-end-time="{{ item.endTimeInt }}" 
          data-tags="{{ item.tags | join(',') }}"
          data-day="{{ item.days | join(',') }}"
          data-year="{{ item.year }}"
          data-title="{{ item.title | escape }}">
          <td>
            <span class="talk-states">
              <span data-status-item="live" class="blinking-emoji">🔴</span>
              <span data-status-item="done">✅</span>
              <span data-status-item="upcoming">⚪</span>
            </span>
          </td>
          <td data-filter="register">
              <a class="btn btn-sm btn-primary" href="{{ item.register }}" target="_blank">Anmelden</a>
          </td>
          <td data-filter="room">
              <span class="talk-value">{{ item.room.name }}</span>
              <span class="talk-search hidden">{{ item.room.name }}</span>
          </td>
          <td data-filter="date">
           {% if item.startDate and item.startDate == item.endDate %}
            {{ item.startDate }} 
            {% else %}
            {{ item.startDate }} - {{ item.endDate }}
             {% endif %}
        </td>
        <td data-filter="time">
          {% if item.startDate and item.startDate == item.endDate %}
            {% if item.startTime %}{{ item.startTime }}{% endif %}
            {% if item.endTime %} - {{ item.endTime }}{% endif %}
          {% else %}
            {% if item.startTime %}{{ item.startTime }}{% endif %}
            {% if item.endTime %} - {{ item.endTime }}{% endif %}
          {% endif %}
        </td>
        <td data-filter="speakers">
          {% if item.speakers %}
            <span class="talk-value">{{ item.speakers | join(', ') }}</span>
            <span class="talk-search hidden">{{ item.speakers | join(', ') }}</span>
          {% endif %}
        </td>
        <td data-filter="title">
          <span class="talk-value">
          <strong>{{ item.title }}</strong>
          </span>
          <span class="talk-search hidden">{{ item.title }}</span>
        </td>
        <td class="hidden">
          {% if item.description %}
            <span class="talk-value">{{ item.description | join(', ') }}</span>
            <span class="talk-search hidden">{{ item.description | join(', ') }}</span>
          {% endif %}
          </td>
          
          
        
      </tr>
    {% endfor %}
  </table>
    {% endfor %}
</div>
  
</div>
<footer class="container text-center my-5 small text-light">
  Made with <span style="color: red;">♥</span> by <a class="text-light" href="https://robert.berlin" target="_blank">Robert Willemelis</a><br />
  {# built from version <span data-version="{{ data.version }}">#{{ data.version }}</span><br /> #}
  <img src="/assets/tech/github.svg" width="16" height="16" class="rounded-circle">
  <a class="text-light" href="https://github.com/willi84/kreativsause-schedule" target="_blank">Github</a>
</footer>
<style>


  
  /* body.compact-view .talk-card > *:not(.card-body) { display: none; }
  body.compact-view .talk-card .card-body {
    display: flex;
    flex-direction: row;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: baseline;
  }
  body.compact-view .talk-card .card-body > *:not(.talk-value):not(.talk-search):not(.talk-time) {
    display: none;
  }
  body.compact-view .talk-card .talk-value,
  body.compact-view .talk-card .talk-time {
    font-size: 0.9rem;
    font-weight: 400;
  } */
</style>
